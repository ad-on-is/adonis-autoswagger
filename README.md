<h1 align="center">
Adonis AutoSwagger <br />
<svg viewBox="0 0 108 36" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 150px; top: 2px; position: relative;">
<path fill-rule="evenodd" clip-rule="evenodd" d="M0 16.3331C0 29.506 3.16017 32.6662 16.3331 32.6662C29.506 32.6662 32.6662 29.506 32.6662 16.3331C32.6662 3.16017 29.506 0 16.3331 0C3.16017 0 0 3.16017 0 16.3331ZM6.58646 19.7261L11.7093 8.08338C12.5742 6.12075 14.2374 5.05627 16.3331 5.05627C18.4288 5.05627 20.092 6.12075 20.9569 8.08338L26.0797 19.7261C26.3126 20.2916 26.5122 21.0235 26.5122 21.6555C26.5122 24.5495 24.483 26.5787 21.589 26.5787C20.6032 26.5787 19.8203 26.3271 19.0278 26.0725C18.2158 25.8116 17.3937 25.5475 16.3331 25.5475C15.2847 25.5475 14.4426 25.814 13.6145 26.076C12.8136 26.3294 12.0258 26.5787 11.0772 26.5787C8.18318 26.5787 6.15402 24.5495 6.15402 21.6555C6.15402 21.0235 6.35361 20.2916 6.58646 19.7261ZM16.3331 10.1125L11.2768 21.5557C12.7737 20.8571 14.5035 20.5245 16.3331 20.5245C18.0961 20.5245 19.8924 20.8571 21.3228 21.5557L16.3331 10.1125Z" fill="currentColor"></path>
<path fill-rule="evenodd" clip-rule="evenodd" d="M94.0883 8.03894C92.9542 8.03894 92.1352 8.84223 92.1352 9.96054C92.1352 11.0788 92.9542 11.8821 94.0883 11.8821C95.2223 11.8821 96.0414 11.0788 96.0414 9.96054C96.0414 8.84223 95.2223 8.03894 94.0883 8.03894ZM58.3654 24.5458C55.3413 24.5458 53.1519 22.3097 53.1519 18.8125C53.1519 15.2523 55.3413 13.0162 58.3654 13.0162C59.7673 13.0162 60.8068 13.4887 61.4211 14.418V8.54297H64.5713V24.2938H61.4211V23.1755C60.8226 24.089 59.783 24.5458 58.3654 24.5458ZM56.3651 18.8125C56.3651 16.8594 57.4204 15.5836 59.027 15.5836C60.6493 15.5836 61.6889 16.8436 61.6889 18.7967C61.6889 20.7183 60.6493 21.9627 59.027 21.9627C57.4204 21.9627 56.3651 20.7183 56.3651 18.8125ZM69.517 18.781C69.517 16.8436 70.5723 15.5993 72.1474 15.5993C73.7382 15.5993 74.7935 16.8436 74.7935 18.781C74.7935 20.7183 73.7382 21.9627 72.1474 21.9627C70.5723 21.9627 69.517 20.7183 69.517 18.781ZM104.232 21.2854C104.232 21.8681 103.791 22.2147 102.672 22.2147C101.412 22.2147 100.625 21.5531 100.625 20.7498H97.4747C97.5535 22.9235 99.6168 24.5458 102.609 24.5458C105.445 24.5458 107.256 23.2857 107.256 21.0491C107.256 19.3795 106.185 18.214 104.059 17.7887L101.775 17.3319C101.082 17.1902 100.672 16.8436 100.672 16.3869C100.672 15.7096 101.365 15.3473 102.247 15.3473C103.507 15.3473 103.996 15.9301 103.996 16.6231H106.988C106.909 14.5755 105.303 13.0162 102.31 13.0162C99.5223 13.0162 97.6322 14.418 97.6322 16.5444C97.6322 18.466 98.8765 19.3323 100.735 19.726L103.003 20.2143C103.744 20.3718 104.232 20.6868 104.232 21.2854ZM95.6791 24.2938H92.5289V13.2682H95.6791V24.2938ZM82.8895 13.2682V14.418C83.6927 13.4887 84.7638 13.0162 86.0869 13.0162C88.5597 13.0162 90.1663 14.6228 90.1663 17.1114V24.2938H87.0162V17.7729C87.0162 16.4341 86.2601 15.6308 84.9528 15.6308C83.6455 15.6308 82.8895 16.4341 82.8895 17.7729V24.2938H79.7393V13.2682H82.8895ZM72.1474 13.0162C68.7925 13.0162 66.3039 15.4418 66.3039 18.781C66.3039 22.1202 68.7925 24.5458 72.1474 24.5458C75.5181 24.5458 78.0067 22.1202 78.0067 18.781C78.0067 15.4418 75.5181 13.0162 72.1474 13.0162ZM45.8751 15.5836C44.2685 15.5836 43.2132 16.8594 43.2132 18.8125C43.2132 20.7183 44.2685 21.9627 45.8751 21.9627C47.4974 21.9627 48.5369 20.7183 48.5369 18.7967C48.5369 16.8436 47.4974 15.5836 45.8751 15.5836ZM40 18.8125C40 22.3097 42.1894 24.5458 45.1978 24.5458C46.6311 24.5458 47.6549 24.089 48.2692 23.1755V24.2938H51.4193V13.2682H48.2692V14.418C47.6391 13.4887 46.5996 13.0162 45.1978 13.0162C42.1894 13.0162 40 15.2523 40 18.8125Z" fill="currentColor"></path>
</svg>&nbsp;<img src="https://upload.wikimedia.org/wikipedia/commons/a/ab/Swagger-logo.png" height="50" />
</h1>

### Auto-Generate swagger docs for AdonisJS

## ðŸ’»ï¸ Install

```bash
pnpm i adonis-autoswagger #using pnpm
```

---

## â­ï¸ Features

- Creates **paths** automatically based on `routes.ts`
- Creates **schemas** automatically based on `app/Models/*`
- Creates **schemas** automatically based on `app/Interfaces/*`
- **Rich configuration** via comments
- Works also in **production** mode
- `node ace docs:generate` command

---

## âœŒï¸Usage

Create a file `/config/swagger.ts`

```ts
// for AdonisJS v6
import path from "node:path";
import url from "node:url";
// ---

export default {
  // path: __dirname + "/../", for AdonisJS v5
  path: path.dirname(url.fileURLToPath(import.meta.url)) + "/../", // for AdonisJS v6
  title: "Foo",
  version: "1.0.0",
  tagIndex: 2,
  snakeCase: true,
  ignore: ["/swagger", "/docs"],
  preferredPutPatch: "PUT", // if PUT/PATCH are provided for the same route, prefer PUT
  common: {
    parameters: {}, // OpenAPI conform parameters that are commonly used
    headers: {}, // OpenAPI conform headers that are commonly used
  },
  persistAuthorization: true, // persist authorization between reloads on the swagger page
  showFullPath: false, // the path displayed after endpoint summary
};
```

In your `routes.ts`

## 6ï¸âƒ£ for AdonisJS v6

```js
import AutoSwagger from "adonis-autoswagger";
import swagger from "#config/swagger";
// returns swagger in YAML
router.get("/swagger", async () => {
  return AutoSwagger.default.docs(router.toJSON(), swagger);
});

// Renders Swagger-UI and passes YAML-output of /swagger
router.get("/docs", async () => {
  return AutoSwagger.default.ui("/swagger", swagger);
  // return AutoSwagger.default.scalar("/swagger", swagger); to use Scalar instead
  // return AutoSwagger.default.rapidoc("/swagger", swagger); to use RapiDoc instead
});
```

## 5ï¸âƒ£ for AdonisJS v5

```js
import AutoSwagger from "adonis-autoswagger";
import swagger from "Config/swagger";
// returns swagger in YAML
Route.get("/swagger", async () => {
  return AutoSwagger.docs(Route.toJSON(), swagger);
});

// Renders Swagger-UI and passes YAML-output of /swagger
Route.get("/docs", async () => {
  return AutoSwagger.ui("/swagger", swagger);
});
```

### ðŸ‘ï¸ Done!

Visit `http://localhost:3333/docs` to see AutoSwagger in action.

### Functions

- `async docs(routes, conf)`: get the specification in YAML format
- `async json(routes, conf)`: get the specification in JSON format
- `ui(path, conf)`: get default swagger UI
- `rapidoc(path, style)`: get rapidoc UI
- `scalar(path)`: get scalar UI
- `jsonToYaml(json)`: can be used to convert `json()` back to yaml

---

## ðŸ§‘â€ðŸ’» Advanced usage

```ts
Route.get("/myswagger", async () => {
  const json = await AutoSwagger.json(Route.toJSON(), swagger);
  // modify json to your hearts content
  return AutoSwagger.jsonToYaml(json);
});

Route.get("/docs", async () => {
  return AutoSwagger.ui("/myswagger", swagger);
});
```

---

## ðŸ“ƒ Configure

### `tagIndex`

Tags endpoints automatically

- If your routes are `/api/v1/products/...` then your tagIndex should be `3`
- If your routes are `/v1/products/...` then your tagIndex should be `2`
- If your routes are `/products/...` then your tagIndex should be `1`

### `ignore`

Ignores specified paths. When used with a wildcard (\*), AutoSwagger will ignore everything matching before/after the wildcard.
`/test/_`will ignore everything starting with`/test/`, whereas `\*/test`will ignore everything ending with`/test`.

### `common`

Sometimes you want to use specific parameters or headers on multiple responses.

_Example:_ Some resources use the same filter parameters or return the same headers.

Here's where you can set these and use them with `@paramUse()` and `@responseHeader() @use()`. See practical example for further details.

---

# ðŸ’« Extend Controllers

## Add additional documentation to your Controller-files.

**@summary** (only one)
A summary of what the action does

**@description** (only one)
A detailed description of what the action does.

**@operationId** (only one)
An optional unique string used to identify an operation. If provided, these IDs must be unique among all operations described in your API..

**@responseBody** (multiple)

Format: `<status> - <return> - <description>`

`<return>` can be either a `<Schema>`, `<Schema[]>/` or a custom JSON `{}`

**@responseHeader** (multiple)

Format: `<status> - <name> - <description> - <meta>`

**@param`Type`** (multiple)

`Type` can be one of [Parameter Types](https://swagger.io/docs/specification/describing-parameters/) (first letter in uppercase)

**@requestBody** (only one)
A definition of the expected requestBody

Format: `<body>`

`<body>` can be either a `<Schema>`, `<Schema[]>/`, or a custom JSON `{}`

**@requestFormDataBody** (only one)
A definition of the expected requestBody that will be sent with formData format.

Format: `{}`

This format should be a valid openapi 3.x json.

---

# ðŸ¤˜Examples

## `@responseBody` examples

```js
@responseBody <status> - Lorem ipsum Dolor sit amet

@responseBody <status> // returns standard <status> message

@responseBody <status> - <Model> // returns model specification

@responseBody <status> - <Model[]> // returns model-array specification

@responseBody <status> - <Model>.with(relations, property1, property2.relations, property3.subproperty.relations) // returns a model and a defined relation

@responseBody <status> - <Model[]>.with(relations).exclude(property1, property2, property3.subproperty) // returns model specification

@responseBody <status> - <Model[]>.append("some":"valid json") // append additional properties to a Model

@responseBody <status> - <Model>.only(property1, property2) // pick only specific properties

@responseBody <status> - {"foo": "bar"} //returns custom json
```

## `@requestBody` examples

```js
// basicaly same as @response, just without a status
@requestBody <Model> // Expects model specification
@requestBody <Model>.with(relations) // Expects model and its relations
@requestBody <Model[]>.append("some":"valid json") // append additional properties to a Model
@requestBody {"foo": "bar"} // Expects a specific JSON
```

## `@requestFormDataBody` examples

```js
// basicaly same as @response, just without a status
@requestFormDataBody {"name":{"type":"string"},"picture":{"type":"string","format":"binary"}} // Expects a valid OpenAPI 3.x JSON
```

---

# **Practical example**

`config/swagger.ts`

```js
export default {
  path: __dirname + "../",
  title: "YourProject",
  version: "1.0.0",
  tagIndex: 2,
  ignore: ["/swagger", "/docs", "/v1", "/", "/something/*", "*/something"],
  common: {
    parameters: {
      sortable: [
        {
          in: "query",
          name: "sortBy",
          schema: { type: "string", example: "foo" },
        },
        {
          in: "query",
          name: "sortType",
          schema: { type: "string", example: "ASC" },
        },
      ],
    },
    headers: {
      paginated: {
        "X-Total-Pages": {
          description: "Total amount of pages",
          schema: { type: "integer", example: 5 },
        },
        "X-Total": {
          description: "Total amount of results",
          schema: { type: "integer", example: 100 },
        },
        "X-Per-Page": {
          description: "Results per page",
          schema: { type: "integer", example: 20 },
        },
      },
    },
  },
};
```

`app/Controllers/Http/SomeController.ts`

```js

export default class SomeController {
  /**
   * @index
   * @operationId getProducts
   * @description Returns array of producs and it's relations
   * @responseBody 200 - <Product[]>.with(relations)
   * @paramUse(sortable, filterable)
   * @responseHeader 200 - @use(paginated)
   * @responseHeader 200 - X-pages - A description of the header - @example(test)
   */
  public async index({ request, response }: HttpContextContract) {}

  /**
   * @show
   * @paramPath id - Describe the param
   * @description Returns a product with it's relation on user and user relations
   * @responseBody 200 - <Product>.with(user, user.relations)
   * @responseBody 404
   */
  public async show({ request, response }: HttpContextContract) {}

  /**
   * @update
   * @responseBody 200
   * @responseBody 404 - Product could not be found
   * @requestBody <Product>
   */
  public async update({ request, response }: HttpContextContract) {}


  /**
   * @custom
   * @summary Lorem ipsum dolor sit amet
   * @paramPath provider - The login provider to be used - @enum(google, facebook, apple)
   * @responseBody 200 - {"token": "xxxxxxx"}
   * @requestBody {"code": "xxxxxx"}
   */
  public async custom({ request, response }: HttpContextContract) {}

}

```

---

## What does it do?

AutoSwagger tries to extracat as much information as possible to generate swagger-docs for you.

## Paths

Automatically generates swagger path-descriptions, based on your application routes. It also detects endpoints, protected by the auth-middlware.

![paths](https://i.imgur.com/EnPw6xT.png)

### Responses and RequestBody

Generates responses and requestBody based on your simple Controller-Annotation (see Examples)

---

## Schemas

### Models

Automatically generates swagger schema-descriptions based on your models

![alt](https://i.imgur.com/FEdLplp.png)

### Interfaces

Instead of using `param: any` you can now use custom interfaces `param: UserDetails`. The interfaces files need to be located at `app/Interfaces/`

## Extend Models

Add additional documentation to your Models properties.

### SoftDelete

Either use `compose(BaseModel, SoftDeletes)` or add a line `@swagger-softdeletes` to your Model.

## Attention!

The below comments MUST be placed **1 line** above the property.

---

**@no-swagger**
Although, autoswagger detects `serializeAs: null` fields automatically, and does not show them. You can use @no-swagger for other fields.

**@enum(foo, bar)**
If a field has defined values, you can add them into an enum. This is usesfull for something like a status field.

**@example(foo bar)**
Use this field to provide own example values for specific fields

Product.js

```js
@hasMany(() => ProductView)
// @no-swagger
public views: HasMany<typeof ProductView>


@column()
// @enum(pending, active, deleted)
public status: string

@column()
// @example(johndoe@example.com)
public email: string
```

---

## Production environment

To make it work in production environments, additional steps are required

- Create a new command for `docs:generate` [See official documentation](https://docs.adonisjs.com/guides/ace-commandline#creating-a-new-command)

  - This should create a new file in `commands/DocsGenerate.ts`

- Use the provided `DocsGenerate.ts.examle`/`DocsGeneratev6.ts.example` and put its contents into your newly created `DocsGenerate.ts`

- Execute the following

```bash
node ace docs:generate
node ace build --production
cp swagger.yml build/
```
